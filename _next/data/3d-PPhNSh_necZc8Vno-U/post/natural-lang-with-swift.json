{"pageProps":{"postContent":{"title":"NSLinguistic​Taggerで遊ぶ","date":"2016-08-14T21:34:14+09:00","slug":"natural-lang-with-swift","tags":["Swift"],"draft":false,"content":"<p><a href=\"https://realm.io/news/natural-language-processing-with-swift/\">\"Natural Language Processing with Swift\"</a>という素晴らしいトークを拝見しました．トークの中では，ナイーブベイズ分類器を用いた簡易のスパムフィルタの実装が説明されています．\nその中で<a href=\"https://developer.apple.com/library/mac/documentation/Cocoa/Reference/NSLinguisticTagger_Class/\"><code>NSLinguistic​Tagger</code></a>という便利なクラスを知り，気になったので触ってみました．(環境は Xcode 7.3.1, Swift 2.2 です．)</p>\n<h2>初期化する</h2>\n<p><code>NSLinguistic​Tagger</code>の初期には<code>tagSchemes</code>と<code>options</code>を渡します．\n型はそれぞれ<code>[String]</code>と<code>Int</code>です．</p>\n<p><code>NSLinguistic​Tagger</code>はなかなか多機能なやつで，<code>tagSchemes</code>には用途に応じたパラメータを渡すことになります．これは後ほど調べるとして，今はとにかくテキトーに初期化してみます．</p>\n<pre><code><span>let</span> tagger <span>=</span> <span>NSLinguisticTagger</span>(tagSchemes: [<span>NSLinguisticTagSchemeLexicalClass</span>], options: <span>0</span>)</code></pre>\n<p><code>tagSchemes</code>は LexicalClass，<code>options</code>は特に指定せずにインスタンスを取得出来ました．</p>\n<h2>試す</h2>\n<p>先ほど初期化した<code>NSLinguistic​Tagger</code>の簡単な使用例を見ていきます．</p>\n<pre><code><span>let</span> sentence <span>=</span> <span>\"I'm Spider-man.\"</span>\n<span>let</span> range <span>=</span> <span>NSRange</span>(location: <span>0</span>, length: sentence.characters.count)\n\ntagger.string <span>=</span> sentence\n\ntagger.enumerateTagsInRange(\n    range,\n    scheme: <span>NSLinguisticTagSchemeLexicalClass</span>,\n    options: .<span>OmitWhitespace</span>) { tag, tokenRange, <span>_</span>, <span>_</span> <span>in</span>\n        <span>let</span> start <span>=</span> sentence.startIndex.advancedBy(tokenRange.location)\n        <span>let</span> end <span>=</span> sentence.startIndex.advancedBy(tokenRange.location <span>+</span> tokenRange.length)\n\n        <span>let</span> token <span>=</span> sentence.substringWithRange(start <span>..&#x3C;</span> end)\n        <span>print</span>(<span>\"<span>\\(token)</span> (<span>\\(tag)</span>)\"</span>)\n    }</code></pre>\n<p>出力結果は以下の通り．<code>()</code>の中身が<code>tagger</code>によって付加された tag です．</p>\n<pre><code>I (Pronoun)\n'm (Verb)\nSpider (Noun)\n- (Dash)\nman (Noun)\n. (SentenceTerminator)</code></pre>\n<p>このように文章の品詞分解が出来ました．</p>\n<h2>Tagging Schemes</h2>\n<p>Scheme の指定を変更することで様々な結果を得ることが出来ます．(上記の例では LexicalClass を指定しました．)</p>\n<p>英語のテキストに対して指定可能な Scheme の一覧は以下のように取得出来ます．</p>\n<pre><code><span>let</span> availableSchemes <span>=</span> <span>NSLinguisticTagger</span>.availableTagSchemesForLanguage(<span>\"en\"</span>)\n<span>// => [\"TokenType\", \"Language\", \"Script\", \"Lemma\", \"LexicalClass\", \"NameType\", \"NameTypeOrLexicalClass\"]</span></code></pre>\n<p>試しに別な Scheme を指定して，先ほどのコードを実行してみます．（結果のみ）</p>\n<h3>TokenType</h3>\n<pre><code>I (Word)\n'm (Word)\nSpider (Word)\n- (Punctuation)\nman (Word)\n. (Punctuation)</code></pre>\n<h3>NameType</h3>\n<pre><code>I (OtherWord)\n'm (OtherWord)\nSpider (OtherWord)\n- (Dash)\nman (OtherWord)\n. (SentenceTerminator)</code></pre>\n<h3>Language</h3>\n<pre><code>I (en)\n'm (en)\nSpider (en)\n- ()\nman (en)\n. ()</code></pre>\n<p>と，このように異なる tagging がされていることが分かります．</p>\n<p>Tag Schemes の一覧は<a href=\"https://developer.apple.com/library/mac/documentation/Cocoa/Reference/NSLinguisticTagger_Class/#//apple_ref/doc/constant_group/Linguistic_Tag_Schemes\">公式ドキュメント</a>を確認して下さい．</p>\n<h2>Options</h2>\n<p>上記の例では OmitWhitespace を指定していたので空白の除去が行われていました．</p>\n<p>Options の一覧は<a href=\"https://developer.apple.com/library/mac/documentation/Cocoa/Reference/NSLinguisticTagger_Class/#//apple_ref/c/tdef/NSLinguisticTaggerOptions\">公式ドキュメント</a>を確認して下さい．</p>\n<p>句読点の除去を行う OmitPunctuation や\"New York\"などを一単語として扱う JoinNames などがあります．</p>\n<p>複数の option を指定したい場合は or 演算<code>|</code>を行います．</p>\n<pre><code><span>let</span> optionsRawValue: <span>UInt</span> <span>=</span>\n<span>NSLinguisticTaggerOptions</span>.<span>OmitWhitespace</span>.rawValue <span>|</span> <span>NSLinguisticTaggerOptions</span>.<span>JoinNames</span>.rawValue\n\n<span>let</span> optionsInt <span>=</span> <span>Int</span>(optionsRawValue)\n<span>let</span> options <span>=</span> <span>NSLinguisticTaggerOptions</span>(rawValue: optionsRawValue)</code></pre>\n<h2>遊ぶ</h2>\n<p>では最後にサンプルコードを掲載します．Playground でそのまま実行出来るはずです．</p>\n<pre><code><span>import</span> Foundation\n\n<span>extension</span> <span>NSRange</span> {\n    <span>func</span> <span>rangeForString</span>(<span>string</span>: <span>String</span>) -> <span>Range</span>&#x3C;<span>String</span>.<span>Index</span>>? {\n        <span>guard</span> location <span>!=</span> <span>NSNotFound</span> <span>else</span> { <span>return</span> <span>nil</span> }\n        <span>let</span> start <span>=</span> string.startIndex.advancedBy(location)\n        <span>let</span> end <span>=</span> string.startIndex.advancedBy(location <span>+</span> length)\n        <span>return</span> start <span>..&#x3C;</span> end\n    }\n}\n\n<span>let</span> sentence1 <span>=</span> <span>\"With great power comes great responsibility.\"</span>\n<span>let</span> sentence2 <span>=</span> <span>\"In critical moments, men sometimes see exactly what they wish to see.\"</span>\n<span>let</span> sentence3 <span>=</span> <span>\"He can make the choice that no one else can make, the right choice.\"</span>\n\n<span>let</span> availableSchemes <span>=</span> <span>NSLinguisticTagger</span>.availableTagSchemesForLanguage(<span>\"en\"</span>)\n<span>let</span> optionsRawValue: <span>UInt</span> <span>=</span>\n    <span>NSLinguisticTaggerOptions</span>.<span>OmitWhitespace</span>.rawValue <span>|</span> <span>NSLinguisticTaggerOptions</span>.<span>JoinNames</span>.rawValue\n\n<span>let</span> tagger <span>=</span> <span>NSLinguisticTagger</span>(tagSchemes: availableSchemes, options: <span>Int</span>(optionsRawValue))\n\n<span>for</span> sentence <span>in</span> [sentence1, sentence2, sentence3] {\n    tagger.string <span>=</span> sentence\n\n    <span>let</span> range <span>=</span> <span>NSRange</span>(location: <span>0</span>, length: sentence.characters.count)\n    tagger.enumerateTagsInRange(\n        range,\n        scheme: <span>NSLinguisticTagSchemeNameTypeOrLexicalClass</span>,\n        options: <span>NSLinguisticTaggerOptions</span>(rawValue: optionsRawValue)) {\n            tag, tokenRange, sentenceRange, stop <span>in</span>\n            <span>let</span> token <span>=</span> sentence.substringWithRange(tokenRange.rangeForString(sentence)<span>!</span>)\n            <span>print</span>(<span>\"<span>\\(tag)</span>: <span>\\(token)</span>\"</span>)\n    }\n    <span>print</span>(<span>\"<span>\\n</span>\"</span>)\n}</code></pre>\n<hr>\n<h1>参考</h1>\n<ul>\n<li><a href=\"https://developer.apple.com/library/mac/documentation/Cocoa/Reference/NSLinguisticTagger_Class/\">NSLinguisticTagger Class Reference</a></li>\n<li><a href=\"https://realm.io/jp/news/natural-language-processing-with-swift/\">Natural Language Processing with Swift</a></li>\n<li><a href=\"https://nshipster.com/nslinguistictagger/\">NSLinguisticTagger - NSHipster</a></li>\n</ul>\n"}},"__N_SSG":true}