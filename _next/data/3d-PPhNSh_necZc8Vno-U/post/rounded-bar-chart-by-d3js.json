{"pageProps":{"postContent":{"title":"D3.jsで角丸の棒グラフをつくるには","date":"2018-12-22T18:15:00+09:00","slug":"rounded-bar-chart-by-d3js","tags":["JavaScript","d3.js"],"draft":false,"content":"<p>D3.js で丸角の棒グラフをつくる方法を調べました．</p>\n<hr>\n<p>まず最初に，普通の棒グラフを書いてみます．</p>\n<p>D3.js で棒グラフをつくるとき，通常は以下のようなコードを書くことになります．</p>\n<pre><code>svg\n  .<span>selectAll</span>(<span>\"bar\"</span>)\n  .<span>data</span>(data)\n  .<span>enter</span>()\n  .<span>append</span>(<span>\"rect\"</span>)\n  .<span>style</span>(<span>\"fill\"</span>, <span>\"#E16220\"</span>)\n  .<span>attr</span>(<span>\"x\"</span>, <span><span>d</span> =></span> <span>x</span>(d.<span>name</span>))\n  .<span>attr</span>(<span>\"y\"</span>, <span><span>d</span> =></span> <span>y</span>(d.<span>value</span>))\n  .<span>attr</span>(<span>\"width\"</span>, x.<span>bandwidth</span>())\n  .<span>attr</span>(<span>\"height\"</span>, <span><span>d</span> =></span> height - <span>y</span>(d.<span>value</span>));</code></pre>\n<p>これは，結果として SVG 要素の <code>&#x3C;rect></code> で棒を表現することになります（以下のような）．</p>\n<pre><code>...\n<span>&#x3C;<span>rect</span> <span>x</span>=<span>\"10\"</span> <span>y</span>=<span>\"40\"</span> <span>width</span>=<span>\"100\"</span> <span>height</span>=<span>\"200\"</span>></span><span>&#x3C;/<span>rect</span>></span>\n...</code></pre>\n<p><code>&#x3C;rect></code> には<code>rx</code>と<code>ry</code>という，角を丸めるための属性があります（<a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Element/rect\">*</a>）．しかし，これらは全ての角に適用されてしまうので今回の目的は達成できません．</p>\n<p>そこで，<code>&#x3C;path></code>で円弧を表現することにします．先ほどの棒グラフと同じものを<code>&#x3C;path></code>で書くには以下のようにします．（path のコマンドについては<a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Path_commands\">こちら</a>を参照して下さい．）</p>\n<pre><code>svg\n  .<span>selectAll</span>(<span>\"bar\"</span>)\n  .<span>data</span>(data)\n  .<span>enter</span>()\n  .<span>append</span>(<span>\"path\"</span>)\n  .<span>style</span>(<span>\"fill\"</span>, <span>\"#E16220\"</span>)\n  .<span>attr</span>(\n    <span>\"d\"</span>,\n    <span><span>item</span> =></span> <span>`\n        M<span>${x(item.name)}</span>,<span>${y(item.value)}</span>\n        h<span>${x.bandwidth()}</span>\n        v<span>${height - y(item.value)}</span>\n        h<span>${-x.bandwidth()}</span>Z\n      `</span>\n  );</code></pre>\n<p>これは，左上から時計回りに長方形を描く<code>&#x3C;path></code>です．</p>\n<p>さて，この長方形の左上と右上を丸角にしたいので，<a href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Elliptical_Arc_Curve\">\"Arc curve のコマンド\"</a>を使用して以下のようにします．<code>rx</code> と <code>ry</code> で水平方向と鉛直方向の丸みを調整できます．</p>\n<pre><code>svg\n  .<span>selectAll</span>(<span>\"bar\"</span>)\n  .<span>data</span>(data)\n  .<span>enter</span>()\n  .<span>append</span>(<span>\"path\"</span>)\n  .<span>style</span>(<span>\"fill\"</span>, <span>\"#E16220\"</span>)\n  .<span>attr</span>(\n    <span>\"d\"</span>,\n    <span><span>item</span> =></span> <span>`\n        M<span>${x(item.name)}</span>,<span>${y(item.value) + ry}</span>\n        a<span>${rx}</span>,<span>${ry}</span> 0 0 1 <span>${rx}</span>,<span>${-ry}</span>\n        h<span>${x.bandwidth() - <span>2</span> * rx}</span>\n        a<span>${rx}</span>,<span>${ry}</span> 0 0 1 <span>${rx}</span>,<span>${ry}</span>\n        v<span>${height - y(item.value) - ry}</span>\n        h<span>${-x.bandwidth()}</span>Z\n      `</span>\n  );</code></pre>\n<p>完成です（以下）．</p>\n<h2>おまけ</h2>\n<p>React + D3.js のサンプルをこちらに公開しているので良かったら見てみてください．</p>\n<ul>\n<li>https://github.com/chooblarin/react-d3-example</li>\n</ul>\n"}},"__N_SSG":true}