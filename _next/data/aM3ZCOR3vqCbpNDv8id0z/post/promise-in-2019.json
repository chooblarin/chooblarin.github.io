{"pageProps":{"postContent":{"title":"2019å¹´ã®Promise","date":"2019-12-01T00:00:00+00:00","slug":"promise-in-2019","tags":["JavaScript"],"draft":false,"content":"<p>ã“ã®è¨˜äº‹ã¯<a href=\"https://adventar.org/calendars/4155\">ãƒ•ãƒ©ãƒ¼ Advent Calendar 2019</a>ã® 1 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚</p>\n<p>ä»Šå¹´ã‚‚ JavaScript (TypeSctipt) ã‚’ãŸãã•ã‚“æ›¸ãã¾ã—ãŸã€‚</p>\n<p>JavaScript ã«ã¯ ECMAScript ã¨ã„ã†æ¨™æº–ä»•æ§˜ãŒã‚ã‚Šã¾ã™ãŒï¼Œè¿‘å¹´ã§ã¯ TC39 ã«ã‚ˆã£ã¦æ¯å¹´æ–°ã—ã„æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚è­°è«–ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯å¸¸ã«ã‚ªãƒ¼ãƒ—ãƒ³ã«ãªã£ã¦ã„ã‚‹ã®ã§èª°ã§ã‚‚é–²è¦§ã§ãã¾ã™ <a href=\"https://github.com/tc39\">*</a>ã€‚</p>\n<p>ãã—ã¦ä»Šå›ã¯ JavaScript ã®\"Promise\"ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¦è¿‘æ³ã‚’è§£èª¬ã—ã¾ã™ã€‚</p>\n<h2>Promise ã§éåŒæœŸãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</h2>\n<p>Promise ã¯ ES2015 (ES6)ã§æ­£å¼ã«å°å…¥ã•ã‚Œã¾ã—ãŸãŒï¼Œãã‚Œä»¥å‰ã«ã‚‚ JavaScript ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®éåŒæœŸå‡¦ç†ã®ä¸­å¿ƒã«ã„ã¾ã—ãŸã€‚</p>\n<p>ã¾ãšã¯ Promise ã«ã¤ã„ã¦ç°¡å˜ã«å¾©ç¿’ã—ã¾ã—ã‚‡ã†ã€‚ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ Promise ã‚’ç”Ÿæˆã™ã‚‹ä¸€èˆ¬çš„ãªå½¢å¼ã®ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =></span> {\n  <span class=\"hljs-title hljs-function\">doSomething</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">x</span> =></span> {\n    <span class=\"hljs-keyword\">if</span> (x) {\n      <span class=\"hljs-comment\">// æˆåŠŸ</span>\n      <span class=\"hljs-title hljs-function\">resolve</span>(x);\n    } <span class=\"hljs-keyword\">else</span> {\n      <span class=\"hljs-title hljs-function\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Error</span>(<span class=\"hljs-string\">\"å¤±æ•—ğŸ˜¢\"</span>));\n    }\n  });\n});\n\n\npromise\n  .<span class=\"hljs-title hljs-function\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">result</span> =></span> { ... })\n  .<span class=\"hljs-title hljs-function\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =></span> { ... });\n</code></pre>\n<p><code>doSomething</code> ã¯ä½•ã‚‰ã‹ã®éåŒæœŸå‡¦ç†ã‚’è¡Œã„ï¼Œã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«ã‚ˆã£ã¦çµæœã‚’å¾—ã‚‹é–¢æ•°ã§ã™ã€‚ç„¡äº‹ã«çµæœãŒå¾—ã‚‰ã‚ŒãŸã¨ãã¯ <code>resolve()</code> ã‚’ä½¿ã„ã¾ã™ã€‚ã‚‚ã—ã‚‚çµæœãŒå¾—ã‚‰ã‚Œãªã‹ã£ãŸã¨ãã¯ <code>reject()</code>ã‚’ä½¿ã„ã¾ã™ã€‚</p>\n<p>Promise ã«ã¯\"pending\", \"fulfilled\", \"rejected\" ã® 3 ã¤ã®çŠ¶æ…‹ãŒå­˜åœ¨ã—ã¾ã™ã€‚å…ˆã»ã©ã®ä¾‹ã§ï¼Œ<code>resolve()</code> ã‹ <code>reject()</code> ã‚’å‘¼ã³ã ã™å‰ã®çŠ¶æ…‹ã¯ <strong>pending</strong> çŠ¶æ…‹ã§ã™ã€‚å‘¼ã³å‡ºã—ãŸã‚ã¨ã¯ <strong>fulfilled</strong> ã‹ <strong>rejected</strong> ã®ã„ãšã‚Œã‹ã®çŠ¶æ…‹ã«ãªã‚Šã¾ã™ï¼ˆã“ã‚Œã‚’ <strong>Settled</strong> ã¨å‘¼ã³ã¾ã™ï¼‰ã€‚</p>\n<img src=\"https://user-images.githubusercontent.com/3143302/69895358-261eb400-1371-11ea-9a11-7c88b1a6226d.png\" alt=\"promise has 3 states\" style=\"display:block;margin:0 auto;width:95%;max-width:320px;\">\n<p>Promise ã¯å¿…ãš 3 ã¤ã®ã†ã¡ã„ãšã‚Œã‹çŠ¶æ…‹ã‚’ã¨ã‚Šã¾ã™ãŒï¼ŒSettled ã«ãªã‚‰ãªã„å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ï¼Œä»¥ä¸‹ã® Promise ã¯æ°¸ä¹…ã« pending çŠ¶æ…‹ã§ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\">() =></span> {});\n</code></pre>\n<h2><code>.finally()</code></h2>\n<p>ES2018 ã§ã¯ <code>Promise.prototype.finally()</code> ãŒå°å…¥ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\">promise\n  .<span class=\"hljs-title hljs-function\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">result</span> =></span> { ... })\n  .<span class=\"hljs-title hljs-function\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">error</span> =></span> { ... })\n  .<span class=\"hljs-title hljs-function\">finally</span>(<span class=\"hljs-function\">() =></span> {\n    <span class=\"hljs-comment\">// å¾Œå§‹æœ«ã‚’ã“ã“ã«æ›¸ã</span>\n  });\n</code></pre>\n<p><code>.finally()</code>ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã¯ï¼Œfulfilled ã‹ rejected ã‹ã«é–¢ã‚ã‚‰ãšå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p>\n<h2>è¤‡æ•°ã® Promise ã‚’æ“ã‚‹ <code>Promise.all</code> ã¨ <code>Promise.race</code></h2>\n<p>ES2015 ã§ã¯ï¼Œ è¤‡æ•°ã® Promise ã‚’æ“ä½œã™ã‚‹ API <code>Promise.all</code> ã¨ <code>Promise.race</code> ã® 2 ã¤ãŒå°å…¥ã•ã‚Œã¾ã—ãŸã€‚</p>\n<ul>\n<li><code>Promise.all</code>ï¼šå…¨ã¦ã® Promise ãŒ fulfilled ã¨ãªã£ãŸçµæœ</li>\n<li><code>Promise.race</code>ï¼šã„ãšã‚Œã‹ã® Promise ã®ã†ã¡æœ€åˆã« Settled ã¨ãªã£ãŸçµæœ</li>\n</ul>\n<p><code>Promise.all</code> ã¯è¤‡æ•°ã®éåŒæœŸå‡¦ç†ã‚’åŒæ™‚ã«ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¦ï¼Œå…¨ã¦ãŒå®Œäº†ã—ãŸãã®çµæœã‚’æ‰±ã„ãŸã„ã¨ãã«ä½¿ã„ã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> p1 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =></span> {\n  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =></span> <span class=\"hljs-title hljs-function\">resolve</span>(<span class=\"hljs-string\">\"æˆåŠŸğŸ˜„\"</span>), <span class=\"hljs-number\">100</span>);\n});\n\n<span class=\"hljs-keyword\">const</span> p2 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =></span> {\n  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =></span> <span class=\"hljs-title hljs-function\">resolve</span>(<span class=\"hljs-string\">\"æˆåŠŸğŸ˜\"</span>), <span class=\"hljs-number\">200</span>);\n});\n\n<span class=\"hljs-keyword\">const</span> p3 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =></span> {\n  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =></span> <span class=\"hljs-title hljs-function\">resolve</span>(<span class=\"hljs-string\">\"æˆåŠŸğŸ˜\"</span>), <span class=\"hljs-number\">300</span>);\n});\n\n<span class=\"hljs-title hljs-class\">Promise</span>.<span class=\"hljs-title hljs-function\">all</span>([p1, p2, p3])\n  .<span class=\"hljs-title hljs-function\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">result</span> =></span> <span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(result)) <span class=\"hljs-comment\">// [\"æˆåŠŸğŸ˜„\", \"æˆåŠŸğŸ˜\", \"æˆåŠŸğŸ˜\"]</span>\n  .<span class=\"hljs-title hljs-function\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">e</span> =></span> <span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(e.<span class=\"hljs-property\">message</span>));\n</code></pre>\n<h2><code>Promise.allSettled</code> ã¨ <code>Promise.any</code></h2>\n<p><code>Promise.all</code> ã¯ï¼ŒPromise ãŒ 1 ã¤ã§ã‚‚å¤±æ•—ã—ã¦ <code>rejected</code> ã«ãªã£ãŸã‚‰ï¼Œãã®çµæœã¯ <code>rejected</code> ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> p1 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =></span> {\n  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =></span> <span class=\"hljs-title hljs-function\">resolve</span>(<span class=\"hljs-string\">\"æˆåŠŸğŸ˜„\"</span>), <span class=\"hljs-number\">100</span>);\n});\n\n<span class=\"hljs-keyword\">const</span> p2 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =></span> {\n  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =></span> <span class=\"hljs-title hljs-function\">resolve</span>(<span class=\"hljs-string\">\"æˆåŠŸğŸ˜\"</span>), <span class=\"hljs-number\">200</span>);\n});\n\n<span class=\"hljs-keyword\">const</span> p3 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =></span> {\n  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =></span> <span class=\"hljs-title hljs-function\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Error</span>(<span class=\"hljs-string\">\"å¤±æ•—ğŸ˜­\"</span>)), <span class=\"hljs-number\">300</span>);\n});\n\n<span class=\"hljs-title hljs-class\">Promise</span>.<span class=\"hljs-title hljs-function\">all</span>([p1, p2, p3])\n  .<span class=\"hljs-title hljs-function\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">result</span> =></span> <span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(result))\n  .<span class=\"hljs-title hljs-function\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">e</span> =></span> <span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(e.<span class=\"hljs-property\">message</span>)); <span class=\"hljs-comment\">// \"å¤±æ•—ğŸ˜­\"</span>\n</code></pre>\n<p>ãã“ã§æ–°ãŸã« 2 ã¤ã® API ãŒææ¡ˆã•ã‚Œï¼Œå°å…¥ã•ã‚Œã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚</p>\n<ul>\n<li><code>Promise.allSettled</code>ï¼šå…¨ã¦ã® Promise ãŒ Settled ã¨ãªã£ãŸçµæœ</li>\n<li><code>Promise.any</code>ï¼šã„ãšã‚Œã‹ã® Promise ãŒæœ€åˆã« fulfilled ã¨ãªã£ãŸçµæœã€‚å…¨ã¦ã® Promise ãŒ rejected ã®å ´åˆã«ã®ã¿ï¼Œrejected çŠ¶æ…‹ã«ãªã‚‹ã€‚</li>\n</ul>\n<p>å…ˆã»ã©ã®ä¾‹ã‚’ <code>Promise.allSettled</code> ã‚’ä½¿ã£ã¦æ›¸ãã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> p1 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =></span> {\n  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =></span> <span class=\"hljs-title hljs-function\">resolve</span>(<span class=\"hljs-string\">\"æˆåŠŸğŸ˜„\"</span>), <span class=\"hljs-number\">100</span>);\n});\n\n<span class=\"hljs-keyword\">const</span> p2 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =></span> {\n  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =></span> <span class=\"hljs-title hljs-function\">resolve</span>(<span class=\"hljs-string\">\"æˆåŠŸğŸ˜\"</span>), <span class=\"hljs-number\">200</span>);\n});\n\n<span class=\"hljs-keyword\">const</span> p3 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =></span> {\n  <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =></span> <span class=\"hljs-title hljs-function\">reject</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Error</span>(<span class=\"hljs-string\">\"å¤±æ•—ğŸ˜­\"</span>)), <span class=\"hljs-number\">300</span>);\n});\n\n<span class=\"hljs-title hljs-class\">Promise</span>.<span class=\"hljs-title hljs-function\">allSettled</span>([p1, p2, p3])\n  .<span class=\"hljs-title hljs-function\">then</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">result</span> =></span> <span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(result.<span class=\"hljs-title hljs-function\">map</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">r</span> =></span> r.<span class=\"hljs-property\">value</span>))) <span class=\"hljs-comment\">// [\"æˆåŠŸğŸ˜„\", \"æˆåŠŸğŸ˜\", undefined]</span>\n  .<span class=\"hljs-title hljs-function\">catch</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">e</span> =></span> <span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(e.<span class=\"hljs-property\">message</span>));\n</code></pre>\n<h2><code>async</code> / <code>await</code></h2>\n<p>ES2017 ã§è¿½åŠ ã•ã‚ŒãŸ Async é–¢æ•°ã‚’ä½¿ã†ã¨ï¼ŒPromise ã‚’æ›´ã«æ‰±ã„ã‚„ã™ããªã‚Šã¾ã™ã€‚Async é–¢æ•°ã¯ä»¥ä¸‹ã®ã‚ˆã†ã« <code>async</code> ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒã¤ã„ãŸé–¢æ•°ã§ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title hljs-function\">makePizza</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> ingredients = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title hljs-function\">prepareIngredients</span>(); <span class=\"hljs-comment\">// ææ–™ã‚’ç”¨æ„ã—ã¾ã™</span>\n  <span class=\"hljs-keyword\">const</span> pizza = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title hljs-function\">bakePizza</span>(); <span class=\"hljs-comment\">// ãƒ”ã‚¶ã‚’ç„¼ãã¾ã™</span>\n  <span class=\"hljs-keyword\">return</span> pizza;\n}\n</code></pre>\n<p>Async é–¢æ•°ã®ä¸­ã§ã¯ï¼Œ<code>await</code> ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ <code>await</code> ã¯ Promise ãŒ Settled ã«ãªã‚‹ã¾ã§å¾…æ©Ÿã—ï¼ŒçµæœãŒå¾—ã‚‰ã‚ŒãŸã‚‰å‡¦ç†ã‚’å†é–‹ã—ã¾ã™ã€‚ã‚‚ã—ã‚‚ãã® Promise ãŒ fulfilled ã¨ãªã£ãŸå ´åˆï¼Œ<code>await</code> ã¯ãã®å€¤ã‚’è¿”ã—ã¾ã™ã€‚ã‚‚ã—ã‚‚ rejected ã¨ãªã£ãŸå ´åˆã¯ãã®ã‚¨ãƒ©ãƒ¼ã‚’ throw ã—ã¾ã™ï¼ˆtry-catch æ§‹æ–‡ã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ãã¾ã™ï¼‰ã€‚</p>\n<p>Async é–¢æ•°ã®çµæœã¯å¸¸ã« Promise ã§ã™ã€‚ã—ãŸãŒã£ã¦ä»¥ä¸‹ã® 2 ã¤ã® Async é–¢æ•°ã¯åŒã˜å€¤ï¼ˆ\"ğŸ•\"ã® Promiseï¼‰ã‚’è¿”ã—ã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title hljs-function\">makePizza1</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"ğŸ•\"</span>;\n}\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title hljs-function\">makePizza2</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title hljs-class\">Promise</span>.<span class=\"hljs-title hljs-function\">resolve</span>(<span class=\"hljs-string\">\"ğŸ•\"</span>);\n}\n\n<span class=\"hljs-keyword\">const</span> pizza1 = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title hljs-function\">makePizza1</span>();\n<span class=\"hljs-keyword\">const</span> pizza2 = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title hljs-function\">makePizza2</span>();\n<span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(pizza1 === pizza2); <span class=\"hljs-comment\">// true</span>\n</code></pre>\n<p><code>await</code> ã¯ Promise ã§ã¯ãªã„å€¤ã‚‚å—ã‘ä»˜ã‘ã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> burger1 = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-string\">\"ğŸ”\"</span>;\n<span class=\"hljs-keyword\">const</span> burger2 = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title hljs-class\">Promise</span>.<span class=\"hljs-title hljs-function\">resolve</span>(<span class=\"hljs-string\">\"ğŸ”\"</span>);\n<span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(burger1 === burger2); <span class=\"hljs-comment\">// true</span>\n</code></pre>\n<h3>ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã¨ <code>await</code></h3>\n<p>ã¾ãšæœ€åˆã«ä»¥ä¸‹ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title hljs-function\">delayEcho</span>(<span class=\"hljs-params\">x, ms</span>) {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">resolve</span> =></span>\n    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =></span> {\n      <span class=\"hljs-title hljs-function\">resolve</span>(x);\n    }, ms)\n  );\n}\n</code></pre>\n<p>å¼•æ•° <code>x</code> ã§æŒ‡å®šã—ãŸå€¤ã‚’å¼•æ•°<code>ms</code> ã§æŒ‡å®šã—ãŸåˆ†ã ã‘å¾…ã£ã¦ resolve ã™ã‚‹ Async é–¢æ•°ã§ã™ã€‚</p>\n<p><code>[\"ğŸ”\", \"ğŸ•\", \"ğŸ£\"]</code>ã¨ã„ã†é…åˆ—ã‚’ã“ã®é–¢æ•°ã¨<code>.map()</code> ã§å‡¦ç†ã—ãŸã„ã¨ãï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ããŸããªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒï¼Œ<code>.map()</code> ã«æ¸¡ã—ã¦ã„ã‚‹é–¢æ•°ã« <code>async</code> ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒç„¡ã„ãŸã‚ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚¨ãƒ©ãƒ¼ã§ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title hljs-function\">delayedFoods</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> foods = [<span class=\"hljs-string\">\"ğŸ”\"</span>, <span class=\"hljs-string\">\"ğŸ•\"</span>, <span class=\"hljs-string\">\"ğŸ£\"</span>];\n  <span class=\"hljs-keyword\">return</span> foods.<span class=\"hljs-title hljs-function\">map</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">f</span> =></span> <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title hljs-function\">delayEcho</span>(f, <span class=\"hljs-number\">100</span>)); <span class=\"hljs-comment\">// ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚¨ãƒ©ãƒ¼ ğŸ™…â€â™€ï¸</span>\n}\n\n<span class=\"hljs-keyword\">const</span> x = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title hljs-function\">delayedFoods</span>();\n<span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(x);\n</code></pre>\n<p>ã‚³ãƒ¼ãƒ‰ãƒãƒƒã‚¯é–¢æ•°ã«ã‚‚ <code>async</code> ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã¤ã‘ã‚‹ã¨ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚¨ãƒ©ãƒ¼ã¯ç„¡ããªã‚Šã¾ã™ãŒï¼Œå…ˆã«è¿°ã¹ãŸã¨ãŠã‚Š Async é–¢æ•°ã®è¿”ã‚Šå€¤ã¯ Promise ãªã®ã§ï¼Œæ­£ã—ãå‹•ä½œã™ã‚‹ã«ã¯ï¼Œ<code>Promise.all</code> ã‚’ä½¿ã£ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title hljs-function\">delayedFoods</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> foods = [<span class=\"hljs-string\">\"ğŸ”\"</span>, <span class=\"hljs-string\">\"ğŸ•\"</span>, <span class=\"hljs-string\">\"ğŸ£\"</span>];\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title hljs-class\">Promise</span>.<span class=\"hljs-title hljs-function\">all</span>(foods.<span class=\"hljs-title hljs-function\">map</span>(<span class=\"hljs-keyword\">async</span> f => <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title hljs-function\">delayEcho</span>(f, <span class=\"hljs-number\">100</span>)));\n}\n\n<span class=\"hljs-keyword\">const</span> x = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title hljs-function\">delayedFoods</span>();\n<span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(x); <span class=\"hljs-comment\">// [\"ğŸ”\", \"ğŸ•\", \"ğŸ£\"]</span>\n</code></pre>\n<p>å®Ÿã¯ã“ã®ä¾‹ã¯ï¼Œ <code>delayEcho</code> ã®çµæœã‚’ <code>await</code> ã™ã‚‹å¿…è¦ã¯ãªãä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã¨ã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title hljs-function\">delayedFoods</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> foods = [<span class=\"hljs-string\">\"ğŸ”\"</span>, <span class=\"hljs-string\">\"ğŸ•\"</span>, <span class=\"hljs-string\">\"ğŸ£\"</span>];\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title hljs-class\">Promise</span>.<span class=\"hljs-title hljs-function\">all</span>(foods.<span class=\"hljs-title hljs-function\">map</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">f</span> =></span> <span class=\"hljs-title hljs-function\">delayEcho</span>(f, <span class=\"hljs-number\">100</span>)));\n}\n</code></pre>\n<h2>Async ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>\n<p>æœ€å¾Œã«ï¼ŒES2018 ã§è¿½åŠ ã•ã‚ŒãŸ Async ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¿ã¦ã„ãã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span>* <span class=\"hljs-title hljs-function\">collectFoods</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">await</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title hljs-class\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">resolve</span> =></span> <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =></span> <span class=\"hljs-title hljs-function\">resolve</span>(), <span class=\"hljs-number\">1000</span>));\n  <span class=\"hljs-keyword\">yield</span> <span class=\"hljs-title hljs-function\">delayEcho</span>(<span class=\"hljs-string\">\"ğŸŒ­\"</span>, <span class=\"hljs-number\">100</span>);\n  <span class=\"hljs-keyword\">yield</span> <span class=\"hljs-title hljs-function\">delayEcho</span>(<span class=\"hljs-string\">\"ğŸœ\"</span>, <span class=\"hljs-number\">100</span>);\n  <span class=\"hljs-keyword\">yield</span> <span class=\"hljs-string\">\"ğŸ–\"</span>;\n}\n</code></pre>\n<p><code>collectFoods</code> ã¯ Async ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿é–¢æ•°ã§ã™ã€‚<code>await</code> ã«åŠ ãˆã¦ <code>yield</code> ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚<code>collectFoods</code>ã¯ Async iterator ã‚’ä½œæˆã—ã¾ã™ã€‚Async iterator ã¯ <code>.next()</code> ã‚’å‘¼ã³å‡ºã™ã¨çµæœãŒ Promise ã§è¿”ã£ã¦ãã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> asyncIter = <span class=\"hljs-title hljs-function\">collectFoods</span>();\n<span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(<span class=\"hljs-keyword\">await</span> asyncIter.<span class=\"hljs-title hljs-function\">next</span>()); <span class=\"hljs-comment\">// {value: \"ğŸŒ­\", done: false}</span>\n<span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(<span class=\"hljs-keyword\">await</span> asyncIter.<span class=\"hljs-title hljs-function\">next</span>()); <span class=\"hljs-comment\">// {value: \"ğŸœ\", done: false}</span>\n<span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(<span class=\"hljs-keyword\">await</span> asyncIter.<span class=\"hljs-title hljs-function\">next</span>()); <span class=\"hljs-comment\">// {value: \"ğŸ–\", done: false}</span>\n<span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(<span class=\"hljs-keyword\">await</span> asyncIter.<span class=\"hljs-title hljs-function\">next</span>()); <span class=\"hljs-comment\">// {value: undefined, done: true}</span>\n</code></pre>\n<p>ã•ã‚‰ã«ï¼ŒAsync Iterator ã®ãƒ«ãƒ¼ãƒ—ã¯ <code>for await...of</code> æ§‹æ–‡ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">for</span> <span class=\"hljs-keyword\">await</span> (<span class=\"hljs-keyword\">const</span> food <span class=\"hljs-keyword\">of</span> <span class=\"hljs-title hljs-function\">collectFoods</span>()) {\n  <span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(food);\n  <span class=\"hljs-comment\">// \"ğŸŒ­\"</span>\n  <span class=\"hljs-comment\">// \"ğŸœ\"</span>\n  <span class=\"hljs-comment\">// \"ğŸ–\"</span>\n}\n</code></pre>\n<p>ã¡ãªã¿ã« <code>for await...of</code> æ§‹æ–‡ã¯ Async ã§ã¯ç„¡ã„é€šå¸¸ã® iterator ã§ã‚‚æ­£å¸¸ã«å‹•ä½œã—ã¾ã™ã€‚</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">for</span> <span class=\"hljs-keyword\">await</span> (<span class=\"hljs-keyword\">const</span> food <span class=\"hljs-keyword\">of</span> [<span class=\"hljs-string\">'ğŸ'</span>, <span class=\"hljs-string\">'ğŸŠ'</span>, <span class=\"hljs-title hljs-class\">Promise</span>.<span class=\"hljs-title hljs-function\">resolve</span>(<span class=\"hljs-string\">'ğŸ‹'</span>)]) {\n  <span class=\"hljs-variable hljs-language\">console</span>.<span class=\"hljs-title hljs-function\">log</span>(food);\n  <span class=\"hljs-comment\">// ğŸ</span>\n  <span class=\"hljs-comment\">// ğŸŠ</span>\n  <span class=\"hljs-comment\">// ğŸ‹</span>\n}\n</code></pre>\n<h2>ãŠã‚ã‚Šã«</h2>\n<p>ä»Šå¹´ã¯ï¼Œåƒ­è¶ŠãªãŒã‚‰å‘¨å›²ã®äººã« JavaScript ã‚’æ•™ãˆã‚‹æ©Ÿä¼šã‚’ã„ãŸã ãã“ã¨ãŒå¤šã„ 1 å¹´ã§ã—ãŸã€‚ç‰¹ã« Promise ã«ã¤ã„ã¦è³ªå•ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã‹ã£ãŸã®ã§ï¼Œã“ã®è¨˜äº‹ã‚’æ›¸ã“ã†ã¨æ€ã„ã¤ãã¾ã—ãŸã€‚æ¥å¹´ã‚‚å…ƒæ°—ã«ã‚„ã£ã¦ã„ãã¾ã™ã®ã§ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ ğŸ‘‹</p>\n<h2>å‚è€ƒ</h2>\n<ul>\n<li><a href=\"https://exploringjs.com/es2018-es2019/\">Exploring ES2018 and ES2019</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled\">Promise.allSettled() - JavaScript | MDN</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/any\">Promise.any() - JavaScript | MDN</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of\">for await...of - JavaScript | MDN</a></li>\n<li><a href=\"https://github.com/tc39/proposal-promise-any\">tc39/proposal-promise-any: ECMAScript proposal: Promise.any</a></li>\n<li><a href=\"https://github.com/tc39/proposal-async-iteration\">tc39/proposal-async-iteration: Asynchronous iteration for JavaScript</a></li>\n<li><a href=\"https://v8.dev/features/promise-combinators\">Promise combinators Â· V8</a></li>\n</ul>"}},"__N_SSG":true}