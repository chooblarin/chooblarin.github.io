---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import { slugify } from "../../lib/util";

export const getStaticPaths = (async () => {
  const posts = await getCollection("post");
  const tags = Array.from(
    new Set(posts.flatMap((post) => post.data.tags.flat()))
  );
  return tags.map((tag) => ({
    params: { tag: slugify(tag) },
    props: {
      tag,
      posts: posts
        .filter((post) => post.data.tags.includes(tag))
        .sort((a, b) => b.data.date.getTime() - a.data.date.getTime()),
    },
  }));
}) satisfies GetStaticPaths;

const { tag, posts } = Astro.props;
---

<html lang="ja">
  <head>
    <BaseHead title={""} description={""} />
  </head>
  <body>
    <main class="max-w-[740px] mx-auto px-5 pb-24">
      <h1>{tag}</h1>
      <ul>
        {
          posts.map((post) => (
            <li>
              <a href={`/posts/${slugify(post.slug)}`}>{post.data.title}</a>
            </li>
          ))
        }
      </ul>
    </main>
  </body>
</html>
